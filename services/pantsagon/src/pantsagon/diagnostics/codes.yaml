version: 1

codes:
  - code: LOCK_MISSING
    severity: error
    rule: lock.exists
    message: Repo lock file is missing.
    hint: Run pantsagon init or restore .pantsagon.toml.

  - code: LOCK_PARSE_FAILED
    severity: error
    rule: lock.parse
    message: Repo lock file could not be parsed.
    hint: Fix invalid TOML in .pantsagon.toml.

  - code: LOCK_SECTION_MISSING
    severity: error
    rule: lock.section
    message: Repo lock is missing a required section.
    hint: Regenerate the repo lock or repair the missing section.

  - code: LOCK_PACK_INVALID
    severity: error
    rule: lock.resolved.packs
    message: Repo lock contains an invalid pack entry.
    hint: Ensure each pack has id, version, and source.

  - code: LOCK_PACK_DUPLICATE
    severity: error
    rule: lock.resolved.packs
    message: Repo lock contains duplicate pack entries.
    hint: Remove duplicate pack ids from resolved.packs.

  - code: LOCK_SELECTION_MISMATCH
    severity: warn
    rule: lock.selection
    message: Selection does not match resolved pack set.
    hint: Update selection or re-resolve packs to align.

  - code: INIT_PORTS_MISSING
    severity: error
    rule: init.ports
    message: Init requires renderer, pack catalog, policy engine, and workspace ports.
    hint: Ensure the entrypoint wires required adapters for init.

  - code: PACK_INDEX_UNKNOWN_LANGUAGE
    severity: error
    rule: pack.index.language
    message: Selection language is not defined in the pack index.
    hint: Add the language mapping to packs/_index.json.

  - code: PACK_INDEX_UNKNOWN_FEATURE
    severity: error
    rule: pack.index.feature
    message: Selection feature is not defined in the pack index.
    hint: Add the feature mapping to packs/_index.json.

  - code: PACK_LOCATION_MISSING
    severity: error
    rule: pack.catalog.fetch
    message: Local pack is missing a location.
    hint: Set location for local pack refs in the lock.

  - code: PACK_COMPAT_INVALID
    severity: error
    rule: pack.compatibility
    message: Pack compatibility metadata is invalid.
    hint: Ensure compatibility.pants is a string.

  - code: REPO_SERVICE_MISSING
    severity: error
    rule: repo.service.exists
    message: Service directory is missing for a declared service.
    hint: Regenerate the service or remove it from selection.

  - code: REPO_LAYER_MISSING
    severity: error
    rule: repo.layer.exists
    message: Service layer directory is missing.
    hint: Regenerate the service skeleton or fix the layout.

  - code: PACK_NOT_FOUND
    severity: error
    rule: pack.catalog.fetch
    message: Pack could not be found.
    hint: Check pack id/version and configured pack sources.

  - code: PACK_MISSING_REQUIRED
    severity: error
    rule: pack.requires.packs
    message: Pack is missing required dependency packs.
    hint: Add the required pack or choose a compatible feature set.

  - code: COPIER_UNDECLARED_VARIABLE
    severity: error
    rule: pack.variables.copier_undeclared
    message: Copier defines a variable that is not declared in pack.yaml.
    hint: Declare it in pack.yaml.variables or remove it from copier.yml.

  - code: COPIER_DEFAULT_MISMATCH
    severity: warn
    rule: pack.variables.default_mismatch
    message: Copier default does not match pack.yaml default.
    hint: Align defaults, or run in strict mode to fail builds.

  - code: PACK_FILE_MISSING
    severity: error
    rule: pack.files
    message: Pack is missing a required file.
    hint: Ensure pack.yaml and copier.yml exist in the pack directory.

  - code: PACK_RENDER_FAILED
    severity: error
    rule: pack.render
    message: Pack render failed.
    hint: Check Copier templates and inputs.

  - code: PACK_ID_INVALID
    severity: error
    rule: naming.pack.id
    message: Pack id format is invalid.
    hint: Use lowercase dot-namespaced ids (e.g. pantsagon.core).

  - code: FEATURE_NAME_INVALID
    severity: error
    rule: naming.feature.format
    message: Feature name format is invalid.
    hint: Use lowercase kebab-case or snake_case with no dots.

  - code: FEATURE_NAME_SHADOWS_PACK
    severity: warn
    rule: naming.feature.shadows_pack
    message: Feature name shadows a pack id.
    hint: Rename the feature to avoid confusion with pack identifiers.

  - code: SERVICE_NAME_INVALID
    severity: error
    rule: naming.service.format
    message: Service name format is invalid.
    hint: Use lowercase kebab-case without leading, trailing, or doubled dashes.

  - code: SERVICE_NAME_RESERVED
    severity: error
    rule: naming.service.reserved
    message: Service name is reserved.
    hint: Choose a different name or add project-level reserved names in .pantsagon.toml.

  - code: SERVICE_EXISTS
    severity: error
    rule: service.name
    message: Service already exists.
    hint: Choose a different service name or remove the existing service.

  - code: VARIABLE_NAME_INVALID
    severity: error
    rule: naming.variable.format
    message: Variable name format is invalid.
    hint: Use a valid identifier (letters, numbers, underscore) starting with a letter or underscore.
